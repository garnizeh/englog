# MVP-015: Journal Management Interface

**Feature:** MVP-WEB
**Priority:** P1 (High)
**Effort:** Medium (4 days)
**Dependencies:** MVP-014 (Authentication UI Components)

---

## üìã Objective

Implement comprehensive journal management user interface including journal creation, editing, viewing, search, and organization features using vanilla JavaScript with real-time AI processing feedback and responsive design.

## üéØ Technical Scope

### Journal Entry Interface

- Rich text editor with formatting options
- Metadata input (title, tags, mood, location)
- Real-time word count and reading time estimation
- Auto-save functionality with draft management
- Multimedia attachment support (images, voice notes)

### Journal List and Navigation

- Responsive journal list with pagination
- Search and filtering capabilities
- Sorting options (date, title, mood, tags)
- Bulk operations (delete, export, tag assignment)
- Calendar view for temporal navigation

### AI Processing Integration

- Real-time processing status indicators
- AI insights display with expandable sections
- Processing queue management and retry mechanisms
- Confidence scores and metadata display
- Manual processing trigger for failed entries

### Data Management

- Offline support with local caching
- Conflict resolution for concurrent edits
- Export functionality (JSON, PDF, text)
- Import capabilities for existing journal data
- GDPR compliance with data deletion options

---

## üéØ Acceptance Criteria

### Journal Creation & Editing

- [ ] Rich text editor supports basic formatting (bold, italic, lists)
- [ ] Metadata fields capture title, tags, mood rating, and optional location
- [ ] Real-time word count and estimated reading time updates
- [ ] Auto-save functionality preserves work every 30 seconds
- [ ] Draft management allows resuming incomplete entries

### Journal Management

- [ ] Journal list displays entries with preview snippets
- [ ] Search functionality works across content, titles, and tags
- [ ] Filtering by date range, mood, tags, and processing status
- [ ] Sorting options include date, title, mood score, and relevance
- [ ] Bulk operations support selecting and acting on multiple entries

### AI Integration

- [ ] Processing status indicators show current AI analysis state
- [ ] AI insights display sentiment, themes, and contextual information
- [ ] Processing queue shows pending and failed tasks with retry options
- [ ] Confidence scores help users understand AI accuracy
- [ ] Manual processing trigger for entries that failed automatic analysis

### User Experience

- [ ] Responsive design works seamlessly on mobile and desktop
- [ ] Loading states provide clear feedback during operations
- [ ] Error handling gracefully manages failures with user-friendly messages
- [ ] Keyboard shortcuts support power user workflows
- [ ] Accessibility features ensure usability for all users

---

## üèóÔ∏è Technical Implementation

### Journal Editor Component

```javascript
// js/components/journal/JournalEditor.js
class JournalEditor {
  constructor(container, journalId = null) {
    this.container = container;
    this.journalId = journalId;
    this.currentJournal = null;
    this.isDirty = false;
    this.autoSaveInterval = null;
    this.processingStatus = "idle";

    this.initializeEditor();
    this.startAutoSave();
  }

  initializeEditor() {
    this.container.innerHTML = this.getEditorHTML();
    this.attachEventListeners();

    if (this.journalId) {
      this.loadJournal(this.journalId);
    } else {
      this.initializeNewJournal();
    }
  }

  getEditorHTML() {
    return `
            <div class="journal-editor">
                <div class="editor-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2>${
                          this.journalId ? "Edit" : "New"
                        } Journal Entry</h2>
                        <div class="editor-actions">
                            <button class="btn btn-outline-secondary" id="saveDraft" disabled>
                                <i class="fas fa-save"></i> Save Draft
                            </button>
                            <button class="btn btn-primary" id="publishEntry">
                                <i class="fas fa-paper-plane"></i> Publish
                            </button>
                        </div>
                    </div>

                    <div class="editor-status">
                        <div class="status-indicators">
                            <span id="saveStatus" class="badge bg-secondary">Not saved</span>
                            <span id="processingStatus" class="badge bg-info d-none">
                                <i class="fas fa-robot"></i> AI Analysis: <span id="processingText">Idle</span>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="editor-body">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="content-section">
                                <div class="mb-3">
                                    <label for="entryTitle" class="form-label">Title (Optional)</label>
                                    <input type="text" class="form-control" id="entryTitle"
                                           placeholder="What's on your mind today?" maxlength="200">
                                </div>

                                <div class="mb-3">
                                    <label for="entryContent" class="form-label">Content</label>
                                    <div class="editor-toolbar">
                                        <div class="btn-group" role="group" aria-label="Text formatting">
                                            <button type="button" class="btn btn-outline-secondary btn-sm" data-command="bold" title="Bold">
                                                <i class="fas fa-bold"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" data-command="italic" title="Italic">
                                                <i class="fas fa-italic"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" data-command="insertUnorderedList" title="Bullet List">
                                                <i class="fas fa-list-ul"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" data-command="insertOrderedList" title="Numbered List">
                                                <i class="fas fa-list-ol"></i>
                                            </button>
                                        </div>

                                        <div class="btn-group ms-2" role="group" aria-label="Content actions">
                                            <button type="button" class="btn btn-outline-secondary btn-sm" id="attachImage" title="Add Image">
                                                <i class="fas fa-image"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" id="recordVoice" title="Voice Note">
                                                <i class="fas fa-microphone"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="editor-content" contenteditable="true" id="entryContent"
                                         placeholder="Write your thoughts here..." style="min-height: 300px;"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="metadata-section">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Entry Details</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="moodSlider" class="form-label">
                                                Mood: <span id="moodValue">5</span>/10
                                            </label>
                                            <input type="range" class="form-range" id="moodSlider"
                                                   min="1" max="10" value="5" step="1">
                                            <div class="mood-labels d-flex justify-content-between">
                                                <small>üòû Low</small>
                                                <small>üòê Neutral</small>
                                                <small>üòä High</small>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="entryTags" class="form-label">Tags</label>
                                            <input type="text" class="form-control" id="entryTags"
                                                   placeholder="Add tags separated by commas">
                                            <div class="form-text">Suggestions will appear as you type</div>
                                            <div id="tagSuggestions" class="tag-suggestions mt-2"></div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">Location (Optional)</label>
                                            <button type="button" class="btn btn-outline-primary btn-sm w-100" id="addLocation">
                                                <i class="fas fa-map-marker-alt"></i> Add Current Location
                                            </button>
                                            <div id="currentLocation" class="mt-2 d-none">
                                                <small class="text-muted" id="locationText"></small>
                                                <button type="button" class="btn btn-link btn-sm p-0 ms-2" id="removeLocation">Remove</button>
                                            </div>
                                        </div>

                                        <div class="entry-stats">
                                            <div class="d-flex justify-content-between">
                                                <small class="text-muted">Words: <span id="wordCount">0</span></small>
                                                <small class="text-muted">Reading time: <span id="readingTime">0 min</span></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- AI Insights Panel -->
                                <div class="card mt-3" id="aiInsightsPanel" style="display: none;">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="fas fa-robot text-primary"></i> AI Insights
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="aiInsightsContent">
                                            <div class="text-center py-3">
                                                <div class="spinner-border spinner-border-sm" role="status">
                                                    <span class="visually-hidden">Analyzing...</span>
                                                </div>
                                                <p class="mb-0 mt-2">AI is analyzing your entry...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
  }

  attachEventListeners() {
    // Content change tracking
    const contentEditor = document.getElementById("entryContent");
    const titleInput = document.getElementById("entryTitle");
    const tagsInput = document.getElementById("entryTags");
    const moodSlider = document.getElementById("moodSlider");

    [contentEditor, titleInput, tagsInput, moodSlider].forEach((element) => {
      element.addEventListener("input", () => {
        this.markDirty();
        this.updateWordCount();
        this.updateSuggestions();
      });
    });

    // Formatting toolbar
    document.querySelectorAll("[data-command]").forEach((button) => {
      button.addEventListener("click", (e) => {
        e.preventDefault();
        const command = button.dataset.command;
        document.execCommand(command, false, null);
        contentEditor.focus();
      });
    });

    // Mood slider
    moodSlider.addEventListener("input", (e) => {
      document.getElementById("moodValue").textContent = e.target.value;
      this.markDirty();
    });

    // Action buttons
    document.getElementById("saveDraft").addEventListener("click", () => {
      this.saveDraft();
    });

    document.getElementById("publishEntry").addEventListener("click", () => {
      this.publishEntry();
    });

    // Location handling
    document.getElementById("addLocation").addEventListener("click", () => {
      this.requestLocation();
    });

    document.getElementById("removeLocation").addEventListener("click", () => {
      this.removeLocation();
    });

    // Tag suggestions
    tagsInput.addEventListener("input", () => {
      this.showTagSuggestions();
    });

    // Multimedia
    document.getElementById("attachImage").addEventListener("click", () => {
      this.attachImage();
    });

    document.getElementById("recordVoice").addEventListener("click", () => {
      this.recordVoice();
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "s") {
        e.preventDefault();
        this.saveDraft();
      }
    });
  }

  markDirty() {
    this.isDirty = true;
    const saveDraftBtn = document.getElementById("saveDraft");
    saveDraftBtn.disabled = false;
    document.getElementById("saveStatus").textContent = "Unsaved changes";
    document.getElementById("saveStatus").className = "badge bg-warning";
  }

  updateWordCount() {
    const content = document.getElementById("entryContent").textContent || "";
    const words = content
      .trim()
      .split(/\s+/)
      .filter((word) => word.length > 0);
    const wordCount = words.length;
    const readingTime = Math.ceil(wordCount / 200); // 200 words per minute

    document.getElementById("wordCount").textContent = wordCount;
    document.getElementById("readingTime").textContent = `${readingTime} min`;
  }

  async showTagSuggestions() {
    const input = document.getElementById("entryTags").value;
    const lastTag = input.split(",").pop().trim();

    if (lastTag.length < 2) {
      document.getElementById("tagSuggestions").innerHTML = "";
      return;
    }

    try {
      const response = await fetch(
        `/api/v1/tags/suggestions?q=${encodeURIComponent(lastTag)}`,
        {
          headers: {
            Authorization: `Bearer ${window.authManager.authToken}`,
          },
        }
      );

      if (response.ok) {
        const suggestions = await response.json();
        this.renderTagSuggestions(suggestions, lastTag);
      }
    } catch (error) {
      console.error("Failed to fetch tag suggestions:", error);
    }
  }

  renderTagSuggestions(suggestions, currentTag) {
    const container = document.getElementById("tagSuggestions");

    if (suggestions.length === 0) {
      container.innerHTML = "";
      return;
    }

    const suggestionsHTML = suggestions
      .map(
        (tag) =>
          `<span class="badge bg-light text-dark me-1 mb-1 tag-suggestion" data-tag="${tag.name}">
                ${tag.name} <small>(${tag.usage_count})</small>
            </span>`
      )
      .join("");

    container.innerHTML = suggestionsHTML;

    // Add click handlers
    container.querySelectorAll(".tag-suggestion").forEach((badge) => {
      badge.addEventListener("click", () => {
        const tagName = badge.dataset.tag;
        const tagsInput = document.getElementById("entryTags");
        const currentTags = tagsInput.value.split(",").map((t) => t.trim());
        currentTags[currentTags.length - 1] = tagName;
        tagsInput.value = currentTags.join(", ") + ", ";
        container.innerHTML = "";
        tagsInput.focus();
        this.markDirty();
      });
    });
  }

  async requestLocation() {
    if (!navigator.geolocation) {
      alert("Geolocation is not supported by this browser.");
      return;
    }

    const button = document.getElementById("addLocation");
    button.disabled = true;
    button.innerHTML =
      '<i class="fas fa-spinner fa-spin"></i> Getting location...';

    try {
      const position = await new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject, {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 300000,
        });
      });

      const { latitude, longitude } = position.coords;

      // Reverse geocoding (using a service like OpenStreetMap Nominatim)
      const response = await fetch(
        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`
      );
      const locationData = await response.json();

      const locationText =
        locationData.display_name ||
        `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;

      document.getElementById("locationText").textContent = locationText;
      document.getElementById("currentLocation").classList.remove("d-none");
      button.style.display = "none";

      this.currentLocation = { latitude, longitude, text: locationText };
      this.markDirty();
    } catch (error) {
      console.error("Error getting location:", error);
      alert("Unable to get your location. Please try again.");
    } finally {
      button.disabled = false;
      button.innerHTML =
        '<i class="fas fa-map-marker-alt"></i> Add Current Location';
    }
  }

  removeLocation() {
    document.getElementById("currentLocation").classList.add("d-none");
    document.getElementById("addLocation").style.display = "block";
    this.currentLocation = null;
    this.markDirty();
  }

  startAutoSave() {
    this.autoSaveInterval = setInterval(() => {
      if (this.isDirty) {
        this.saveDraft();
      }
    }, 30000); // Auto-save every 30 seconds
  }

  stopAutoSave() {
    if (this.autoSaveInterval) {
      clearInterval(this.autoSaveInterval);
      this.autoSaveInterval = null;
    }
  }

  async saveDraft() {
    if (!this.isDirty) return;

    const journalData = this.gatherJournalData();
    journalData.status = "draft";

    try {
      const url = this.journalId
        ? `/api/v1/journals/${this.journalId}`
        : "/api/v1/journals";

      const method = this.journalId ? "PUT" : "POST";

      const response = await fetch(url, {
        method,
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${window.authManager.authToken}`,
        },
        body: JSON.stringify(journalData),
      });

      if (response.ok) {
        const result = await response.json();

        if (!this.journalId) {
          this.journalId = result.id;
          // Update URL without page reload
          history.replaceState(null, "", `#/journals/edit/${this.journalId}`);
        }

        this.isDirty = false;
        document.getElementById("saveStatus").textContent = "Draft saved";
        document.getElementById("saveStatus").className = "badge bg-success";
        document.getElementById("saveDraft").disabled = true;

        // Auto-hide success message
        setTimeout(() => {
          document.getElementById("saveStatus").textContent = "Saved";
          document.getElementById("saveStatus").className =
            "badge bg-secondary";
        }, 3000);
      } else {
        throw new Error("Failed to save draft");
      }
    } catch (error) {
      console.error("Save failed:", error);
      document.getElementById("saveStatus").textContent = "Save failed";
      document.getElementById("saveStatus").className = "badge bg-danger";
    }
  }

  async publishEntry() {
    const journalData = this.gatherJournalData();
    journalData.status = "published";

    try {
      const url = this.journalId
        ? `/api/v1/journals/${this.journalId}`
        : "/api/v1/journals";

      const method = this.journalId ? "PUT" : "POST";

      const response = await fetch(url, {
        method,
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${window.authManager.authToken}`,
        },
        body: JSON.stringify(journalData),
      });

      if (response.ok) {
        const result = await response.json();

        // Start AI processing
        this.startAIProcessing(result.id);

        // Show success and redirect
        this.showPublishSuccess();

        setTimeout(() => {
          window.location.hash = `/journals/${result.id}`;
        }, 2000);
      } else {
        throw new Error("Failed to publish entry");
      }
    } catch (error) {
      console.error("Publish failed:", error);
      alert("Failed to publish entry. Please try again.");
    }
  }

  gatherJournalData() {
    const title = document.getElementById("entryTitle").value.trim();
    const content = document.getElementById("entryContent").innerHTML;
    const plainContent = document.getElementById("entryContent").textContent;
    const tags = document
      .getElementById("entryTags")
      .value.split(",")
      .map((tag) => tag.trim())
      .filter((tag) => tag.length > 0);
    const mood = parseInt(document.getElementById("moodSlider").value);

    return {
      raw_data: {
        title: title || null,
        content: content,
        plain_content: plainContent,
        tags: tags,
        mood: mood,
        location: this.currentLocation,
        word_count: plainContent
          .trim()
          .split(/\s+/)
          .filter((w) => w.length > 0).length,
        created_with: "web_editor_v1",
      },
      entry_type: "text",
      metadata: {
        source: "web_app",
        editor_version: "1.0.0",
        user_agent: navigator.userAgent,
      },
    };
  }

  async startAIProcessing(journalId) {
    document.getElementById("processingStatus").classList.remove("d-none");
    document.getElementById("processingText").textContent = "Starting...";
    document.getElementById("aiInsightsPanel").style.display = "block";

    try {
      const response = await fetch(`/api/v1/ai/process/${journalId}`, {
        method: "POST",
        headers: {
          Authorization: `Bearer ${window.authManager.authToken}`,
        },
      });

      if (response.ok) {
        this.monitorProcessing(journalId);
      } else {
        throw new Error("Failed to start AI processing");
      }
    } catch (error) {
      console.error("AI processing failed:", error);
      document.getElementById("processingText").textContent = "Failed";
      document.getElementById("processingStatus").className = "badge bg-danger";
    }
  }

  async monitorProcessing(journalId) {
    const pollInterval = setInterval(async () => {
      try {
        const response = await fetch(
          `/api/v1/journals/${journalId}/processed`,
          {
            headers: {
              Authorization: `Bearer ${window.authManager.authToken}`,
            },
          }
        );

        if (response.ok) {
          const processedData = await response.json();

          if (processedData.length > 0) {
            clearInterval(pollInterval);
            this.displayAIInsights(processedData);
            document.getElementById("processingText").textContent = "Complete";
            document.getElementById("processingStatus").className =
              "badge bg-success";
          } else {
            document.getElementById("processingText").textContent =
              "Processing...";
          }
        }
      } catch (error) {
        console.error("Processing check failed:", error);
        clearInterval(pollInterval);
        document.getElementById("processingText").textContent = "Error";
        document.getElementById("processingStatus").className =
          "badge bg-danger";
      }
    }, 2000);

    // Stop polling after 2 minutes
    setTimeout(() => {
      clearInterval(pollInterval);
      if (
        document.getElementById("processingText").textContent ===
        "Processing..."
      ) {
        document.getElementById("processingText").textContent = "Timeout";
        document.getElementById("processingStatus").className =
          "badge bg-warning";
      }
    }, 120000);
  }

  displayAIInsights(processedData) {
    const container = document.getElementById("aiInsightsContent");
    const sentimentData = processedData.find(
      (p) => p.task_type === "sentiment_analysis"
    );
    const themesData = processedData.find(
      (p) => p.task_type === "theme_identification"
    );

    let insightsHTML = "";

    if (sentimentData) {
      const sentiment = sentimentData.processed_data;
      insightsHTML += `
                <div class="insight-section mb-3">
                    <h6><i class="fas fa-heart text-danger"></i> Sentiment</h6>
                    <div class="sentiment-display">
                        <span class="badge ${this.getSentimentBadgeClass(
                          sentiment.overall_sentiment.score
                        )}">
                            ${sentiment.overall_sentiment.label} (${(
        sentiment.overall_sentiment.score * 100
      ).toFixed(0)}%)
                        </span>
                        <small class="text-muted d-block">Confidence: ${(
                          sentimentData.confidence_score * 100
                        ).toFixed(0)}%</small>
                    </div>
                </div>
            `;
    }

    if (themesData) {
      const themes = themesData.processed_data.primary_themes;
      insightsHTML += `
                <div class="insight-section">
                    <h6><i class="fas fa-tags text-primary"></i> Themes</h6>
                    <div class="themes-display">
                        ${themes
                          .map(
                            (theme) =>
                              `<span class="badge bg-light text-dark me-1 mb-1">
                                ${theme.theme} (${(
                                theme.confidence * 100
                              ).toFixed(0)}%)
                            </span>`
                          )
                          .join("")}
                    </div>
                </div>
            `;
    }

    container.innerHTML =
      insightsHTML || '<p class="text-muted">No insights available yet.</p>';
  }

  getSentimentBadgeClass(score) {
    if (score >= 0.6) return "bg-success";
    if (score >= 0.2) return "bg-warning";
    return "bg-danger";
  }

  showPublishSuccess() {
    const alert = document.createElement("div");
    alert.className =
      "alert alert-success alert-dismissible fade show position-fixed";
    alert.style.cssText =
      "top: 20px; right: 20px; z-index: 1060; min-width: 300px;";
    alert.innerHTML = `
            <i class="fas fa-check-circle"></i> Journal entry published successfully!
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

    document.body.appendChild(alert);

    setTimeout(() => {
      alert.remove();
    }, 5000);
  }

  async loadJournal(journalId) {
    try {
      const response = await fetch(`/api/v1/journals/${journalId}`, {
        headers: {
          Authorization: `Bearer ${window.authManager.authToken}`,
        },
      });

      if (response.ok) {
        const journal = await response.json();
        this.populateEditor(journal);
      } else {
        throw new Error("Journal not found");
      }
    } catch (error) {
      console.error("Failed to load journal:", error);
      alert("Failed to load journal entry.");
    }
  }

  populateEditor(journal) {
    const data = journal.raw_data;

    document.getElementById("entryTitle").value = data.title || "";
    document.getElementById("entryContent").innerHTML = data.content || "";
    document.getElementById("entryTags").value = (data.tags || []).join(", ");
    document.getElementById("moodSlider").value = data.mood || 5;
    document.getElementById("moodValue").textContent = data.mood || 5;

    if (data.location) {
      this.currentLocation = data.location;
      document.getElementById("locationText").textContent = data.location.text;
      document.getElementById("currentLocation").classList.remove("d-none");
      document.getElementById("addLocation").style.display = "none";
    }

    this.updateWordCount();
    this.isDirty = false;
  }

  initializeNewJournal() {
    // Set default values
    const now = new Date();
    const defaultTitle = `Journal Entry - ${now.toLocaleDateString()}`;
    document.getElementById("entryTitle").placeholder = defaultTitle;

    // Focus on content area
    document.getElementById("entryContent").focus();
  }

  destroy() {
    this.stopAutoSave();

    // Clean up event listeners and clear content
    this.container.innerHTML = "";
  }
}

// Export for use in other modules
window.JournalEditor = JournalEditor;
```

### Journal List Component

```javascript
// js/components/journal/JournalList.js
class JournalList {
  constructor(container) {
    this.container = container;
    this.journals = [];
    this.filteredJournals = [];
    this.currentPage = 1;
    this.pageSize = 10;
    this.totalCount = 0;
    this.currentFilters = {};
    this.currentSort = { field: "created_at", direction: "desc" };

    this.initializeList();
    this.loadJournals();
  }

  initializeList() {
    this.container.innerHTML = this.getListHTML();
    this.attachEventListeners();
  }

  getListHTML() {
    return `
            <div class="journal-list">
                <div class="list-header">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>My Journals</h2>
                        <a href="#/journals/new" class="btn btn-primary">
                            <i class="fas fa-plus"></i> New Entry
                        </a>
                    </div>

                    <div class="filters-section mb-4">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-search"></i>
                                    </span>
                                    <input type="text" class="form-control" id="searchInput"
                                           placeholder="Search journals...">
                                </div>
                            </div>

                            <div class="col-md-2">
                                <select class="form-select" id="moodFilter">
                                    <option value="">All Moods</option>
                                    <option value="high">High (8-10)</option>
                                    <option value="medium">Medium (4-7)</option>
                                    <option value="low">Low (1-3)</option>
                                </select>
                            </div>

                            <div class="col-md-2">
                                <select class="form-select" id="dateFilter">
                                    <option value="">All Time</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="year">This Year</option>
                                </select>
                            </div>

                            <div class="col-md-2">
                                <select class="form-select" id="sortSelect">
                                    <option value="created_at,desc">Newest First</option>
                                    <option value="created_at,asc">Oldest First</option>
                                    <option value="title,asc">Title A-Z</option>
                                    <option value="title,desc">Title Z-A</option>
                                    <option value="mood,desc">Highest Mood</option>
                                    <option value="mood,asc">Lowest Mood</option>
                                </select>
                            </div>

                            <div class="col-md-2">
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-secondary" id="viewToggle" title="Toggle View">
                                        <i class="fas fa-th-list"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" id="bulkActions" title="Bulk Actions">
                                        <i class="fas fa-tasks"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="list-content">
                    <div id="journalGrid" class="journal-grid">
                        <div class="text-center py-5">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading your journals...</p>
                        </div>
                    </div>

                    <nav aria-label="Journal pagination" id="paginationNav" class="mt-4">
                        <!-- Pagination will be inserted here -->
                    </nav>
                </div>
            </div>
        `;
  }

  attachEventListeners() {
    // Search functionality
    const searchInput = document.getElementById("searchInput");
    let searchTimeout;

    searchInput.addEventListener("input", (e) => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        this.currentFilters.search = e.target.value;
        this.applyFilters();
      }, 300);
    });

    // Filter controls
    document.getElementById("moodFilter").addEventListener("change", (e) => {
      this.currentFilters.mood = e.target.value;
      this.applyFilters();
    });

    document.getElementById("dateFilter").addEventListener("change", (e) => {
      this.currentFilters.date = e.target.value;
      this.applyFilters();
    });

    // Sort control
    document.getElementById("sortSelect").addEventListener("change", (e) => {
      const [field, direction] = e.target.value.split(",");
      this.currentSort = { field, direction };
      this.applyFilters();
    });

    // View toggle
    document.getElementById("viewToggle").addEventListener("click", () => {
      this.toggleView();
    });

    // Bulk actions
    document.getElementById("bulkActions").addEventListener("click", () => {
      this.toggleBulkMode();
    });
  }

  async loadJournals() {
    try {
      const params = new URLSearchParams({
        page: this.currentPage,
        limit: this.pageSize,
        sort: `${this.currentSort.field},${this.currentSort.direction}`,
        ...this.currentFilters,
      });

      const response = await fetch(`/api/v1/journals?${params}`, {
        headers: {
          Authorization: `Bearer ${window.authManager.authToken}`,
        },
      });

      if (response.ok) {
        const data = await response.json();
        this.journals = data.journals || [];
        this.totalCount = data.total || 0;
        this.renderJournals();
        this.renderPagination();
      } else {
        throw new Error("Failed to load journals");
      }
    } catch (error) {
      console.error("Failed to load journals:", error);
      this.renderError();
    }
  }

  renderJournals() {
    const grid = document.getElementById("journalGrid");

    if (this.journals.length === 0) {
      grid.innerHTML = this.getEmptyStateHTML();
      return;
    }

    const journalsHTML = this.journals
      .map((journal) => this.getJournalCardHTML(journal))
      .join("");
    grid.innerHTML = journalsHTML;

    // Attach event listeners to journal cards
    grid.querySelectorAll(".journal-card").forEach((card) => {
      const journalId = card.dataset.journalId;

      card.addEventListener("click", (e) => {
        if (!e.target.closest(".card-actions")) {
          window.location.hash = `#/journals/${journalId}`;
        }
      });

      // Edit button
      const editBtn = card.querySelector(".edit-btn");
      if (editBtn) {
        editBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          window.location.hash = `#/journals/edit/${journalId}`;
        });
      }

      // Delete button
      const deleteBtn = card.querySelector(".delete-btn");
      if (deleteBtn) {
        deleteBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          this.deleteJournal(journalId);
        });
      }
    });
  }

  getJournalCardHTML(journal) {
    const data = journal.raw_data;
    const title = data.title || "Untitled Entry";
    const content = data.plain_content || data.content || "";
    const preview =
      content.length > 150 ? content.substring(0, 150) + "..." : content;
    const mood = data.mood || 5;
    const tags = data.tags || [];
    const createdAt = new Date(journal.created_at);
    const processingStatus = journal.processing_status || "pending";

    return `
            <div class="journal-card card mb-3" data-journal-id="${journal.id}">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title mb-0">${this.escapeHtml(
                          title
                        )}</h5>
                        <div class="card-actions">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary" type="button"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item edit-btn" href="#"><i class="fas fa-edit"></i> Edit</a></li>
                                    <li><a class="dropdown-item" href="#/journals/${
                                      journal.id
                                    }"><i class="fas fa-eye"></i> View</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger delete-btn" href="#"><i class="fas fa-trash"></i> Delete</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <p class="card-text text-muted">${this.escapeHtml(
                      preview
                    )}</p>

                    <div class="journal-metadata">
                        <div class="d-flex align-items-center gap-3 mb-2">
                            <small class="text-muted">
                                <i class="fas fa-calendar"></i> ${createdAt.toLocaleDateString()}
                            </small>
                            <small class="text-muted">
                                <i class="fas fa-smile"></i> Mood: ${mood}/10
                            </small>
                            <small class="text-muted">
                                <i class="fas fa-file-alt"></i> ${
                                  data.word_count || 0
                                } words
                            </small>
                        </div>

                        ${
                          tags.length > 0
                            ? `
                            <div class="journal-tags mb-2">
                                ${tags
                                  .slice(0, 3)
                                  .map(
                                    (tag) =>
                                      `<span class="badge bg-light text-dark me-1">${this.escapeHtml(
                                        tag
                                      )}</span>`
                                  )
                                  .join("")}
                                ${
                                  tags.length > 3
                                    ? `<span class="text-muted">+${
                                        tags.length - 3
                                      } more</span>`
                                    : ""
                                }
                            </div>
                        `
                            : ""
                        }

                        <div class="processing-status">
                            ${this.getProcessingStatusBadge(processingStatus)}
                        </div>
                    </div>
                </div>
            </div>
        `;
  }

  getProcessingStatusBadge(status) {
    const statusConfig = {
      pending: {
        class: "bg-warning",
        icon: "fa-clock",
        text: "Analysis Pending",
      },
      processing: { class: "bg-info", icon: "fa-robot", text: "AI Processing" },
      completed: {
        class: "bg-success",
        icon: "fa-check",
        text: "Analysis Complete",
      },
      failed: {
        class: "bg-danger",
        icon: "fa-exclamation",
        text: "Analysis Failed",
      },
    };

    const config = statusConfig[status] || statusConfig["pending"];

    return `
            <small class="badge ${config.class}">
                <i class="fas ${config.icon}"></i> ${config.text}
            </small>
        `;
  }

  getEmptyStateHTML() {
    if (Object.keys(this.currentFilters).length > 0) {
      return `
                <div class="empty-state text-center py-5">
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h4>No journals found</h4>
                    <p class="text-muted">Try adjusting your search filters or create a new journal entry.</p>
                    <a href="#/journals/new" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Create New Entry
                    </a>
                </div>
            `;
    }

    return `
            <div class="empty-state text-center py-5">
                <i class="fas fa-book fa-3x text-muted mb-3"></i>
                <h4>Start your journaling journey</h4>
                <p class="text-muted">Create your first journal entry and let AI help you discover insights about your thoughts and emotions.</p>
                <a href="#/journals/new" class="btn btn-primary btn-lg">
                    <i class="fas fa-plus"></i> Write Your First Entry
                </a>
            </div>
        `;
  }

  renderPagination() {
    const nav = document.getElementById("paginationNav");
    const totalPages = Math.ceil(this.totalCount / this.pageSize);

    if (totalPages <= 1) {
      nav.innerHTML = "";
      return;
    }

    let paginationHTML = '<ul class="pagination justify-content-center">';

    // Previous button
    paginationHTML += `
            <li class="page-item ${this.currentPage === 1 ? "disabled" : ""}">
                <a class="page-link" href="#" data-page="${
                  this.currentPage - 1
                }">Previous</a>
            </li>
        `;

    // Page numbers
    const startPage = Math.max(1, this.currentPage - 2);
    const endPage = Math.min(totalPages, this.currentPage + 2);

    if (startPage > 1) {
      paginationHTML += `<li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>`;
      if (startPage > 2) {
        paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
      }
    }

    for (let i = startPage; i <= endPage; i++) {
      paginationHTML += `
                <li class="page-item ${i === this.currentPage ? "active" : ""}">
                    <a class="page-link" href="#" data-page="${i}">${i}</a>
                </li>
            `;
    }

    if (endPage < totalPages) {
      if (endPage < totalPages - 1) {
        paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
      }
      paginationHTML += `<li class="page-item"><a class="page-link" href="#" data-page="${totalPages}">${totalPages}</a></li>`;
    }

    // Next button
    paginationHTML += `
            <li class="page-item ${
              this.currentPage === totalPages ? "disabled" : ""
            }">
                <a class="page-link" href="#" data-page="${
                  this.currentPage + 1
                }">Next</a>
            </li>
        `;

    paginationHTML += "</ul>";
    nav.innerHTML = paginationHTML;

    // Attach pagination event listeners
    nav.querySelectorAll("a[data-page]").forEach((link) => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const page = parseInt(link.dataset.page);
        if (page !== this.currentPage && page >= 1 && page <= totalPages) {
          this.currentPage = page;
          this.loadJournals();
        }
      });
    });
  }

  applyFilters() {
    this.currentPage = 1; // Reset to first page when filtering
    this.loadJournals();
  }

  async deleteJournal(journalId) {
    if (
      !confirm(
        "Are you sure you want to delete this journal entry? This action cannot be undone."
      )
    ) {
      return;
    }

    try {
      const response = await fetch(`/api/v1/journals/${journalId}`, {
        method: "DELETE",
        headers: {
          Authorization: `Bearer ${window.authManager.authToken}`,
        },
      });

      if (response.ok) {
        // Remove from local array and re-render
        this.journals = this.journals.filter((j) => j.id !== journalId);
        this.totalCount--;
        this.renderJournals();
        this.renderPagination();

        // Show success message
        this.showToast("Journal entry deleted successfully", "success");
      } else {
        throw new Error("Failed to delete journal");
      }
    } catch (error) {
      console.error("Delete failed:", error);
      this.showToast("Failed to delete journal entry", "error");
    }
  }

  showToast(message, type = "info") {
    const toast = document.createElement("div");
    toast.className = `alert alert-${
      type === "error" ? "danger" : type
    } alert-dismissible fade show position-fixed`;
    toast.style.cssText =
      "top: 20px; right: 20px; z-index: 1060; min-width: 300px;";
    toast.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

    document.body.appendChild(toast);

    setTimeout(() => {
      toast.remove();
    }, 5000);
  }

  escapeHtml(text) {
    const div = document.createElement("div");
    div.textContent = text;
    return div.innerHTML;
  }

  renderError() {
    const grid = document.getElementById("journalGrid");
    grid.innerHTML = `
            <div class="error-state text-center py-5">
                <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                <h4>Error Loading Journals</h4>
                <p class="text-muted">There was a problem loading your journals. Please try again.</p>
                <button class="btn btn-outline-primary" onclick="location.reload()">
                    <i class="fas fa-refresh"></i> Reload Page
                </button>
            </div>
        `;
  }
}

// Export for use in other modules
window.JournalList = JournalList;
```

---

## üß™ Testing Strategy

### Unit Tests

```javascript
// tests/components/journal-editor.test.js
describe("JournalEditor", () => {
  let container;
  let editor;

  beforeEach(() => {
    container = document.createElement("div");
    document.body.appendChild(container);

    // Mock authManager
    window.authManager = {
      authToken: "mock-token",
      currentUser: { id: "user-123" },
    };

    editor = new JournalEditor(container);
  });

  afterEach(() => {
    editor.destroy();
    document.body.removeChild(container);
  });

  test("initializes with proper HTML structure", () => {
    expect(container.querySelector(".journal-editor")).toBeTruthy();
    expect(container.querySelector("#entryContent")).toBeTruthy();
    expect(container.querySelector("#moodSlider")).toBeTruthy();
  });

  test("tracks word count correctly", () => {
    const contentEditor = container.querySelector("#entryContent");
    contentEditor.textContent =
      "This is a test journal entry with ten words exactly.";

    editor.updateWordCount();

    expect(container.querySelector("#wordCount").textContent).toBe("10");
  });

  test("marks content as dirty when changed", () => {
    const contentEditor = container.querySelector("#entryContent");
    contentEditor.textContent = "New content";
    contentEditor.dispatchEvent(new Event("input"));

    expect(editor.isDirty).toBe(true);
    expect(container.querySelector("#saveDraft").disabled).toBe(false);
  });

  test("gathers journal data correctly", () => {
    container.querySelector("#entryTitle").value = "Test Title";
    container.querySelector("#entryContent").textContent = "Test content";
    container.querySelector("#entryTags").value = "tag1, tag2";
    container.querySelector("#moodSlider").value = "8";

    const data = editor.gatherJournalData();

    expect(data.raw_data.title).toBe("Test Title");
    expect(data.raw_data.tags).toEqual(["tag1", "tag2"]);
    expect(data.raw_data.mood).toBe(8);
  });
});
```

### Integration Tests

```javascript
// tests/integration/journal-management.test.js
describe("Journal Management Integration", () => {
  beforeAll(async () => {
    await setupTestEnvironment();
  });

  test("complete journal creation flow", async () => {
    // Navigate to new journal page
    const editorContainer = document.getElementById("test-container");
    const editor = new JournalEditor(editorContainer);

    // Fill out journal form
    editorContainer.querySelector("#entryTitle").value =
      "Integration Test Journal";
    editorContainer.querySelector("#entryContent").textContent =
      "This is test content for integration testing.";
    editorContainer.querySelector("#moodSlider").value = "7";

    // Mock successful API response
    global.fetch = jest.fn().mockResolvedValueOnce({
      ok: true,
      json: async () => ({ id: "journal-123", status: "published" }),
    });

    // Publish journal
    await editor.publishEntry();

    expect(fetch).toHaveBeenCalledWith(
      "/api/v1/journals",
      expect.objectContaining({
        method: "POST",
        headers: expect.objectContaining({
          "Content-Type": "application/json",
          Authorization: "Bearer mock-token",
        }),
      })
    );
  });
});
```

---

## üéØ Definition of Done

### Functional Requirements

- [ ] Journal editor supports rich text formatting and metadata input
- [ ] Journal list displays entries with search, filter, and sort capabilities
- [ ] Real-time AI processing status and insights display
- [ ] Auto-save functionality preserves work automatically
- [ ] Responsive design works across all device sizes

### Technical Requirements

- [ ] Offline support with local caching implemented
- [ ] Error handling provides graceful degradation
- [ ] Accessibility features meet WCAG 2.1 AA standards
- [ ] Performance optimization ensures fast interactions
- [ ] Security measures protect against XSS and data exposure

### Quality Requirements

- [ ] Unit tests cover 80%+ of component logic
- [ ] Integration tests validate API interactions
- [ ] Manual testing confirms UI/UX requirements
- [ ] Performance testing validates response times
- [ ] Security testing confirms protection measures

---

## üìà Success Metrics

- **User Engagement:** 90%+ of users create multiple journal entries
- **Performance:** Journal editor loads in < 2 seconds
- **AI Processing:** 95%+ successful processing rate
- **User Experience:** < 5 clicks to create and publish entry
- **Accessibility:** Full keyboard navigation support

---

## üîó Dependencies & Integration

- **Depends On:** MVP-014 (Authentication UI Components)
- **Enables:** MVP-016 (AI Insights Dashboard)
- **API Integration:** MVP-005 (Journal Service), MVP-008 (AI Processing Service)
- **Testing Integration:** MVP-020 (Integration Testing Suite)

---

**Created:** August 6, 2025
**Assignee:** Frontend Team
**Sprint:** MVP Sprint 3
