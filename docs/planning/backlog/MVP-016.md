# MVP-016: AI Insights Visualization

**Feature Area:** MVP-WEB (Web Interface)
**Priority:** P2 (Medium)
**Effort:** Medium (3 days)
**Dependencies:** MVP-015 (Journal Management Interface)

## Overview

Create a comprehensive AI insights dashboard that visualizes journal analytics and AI-generated insights in an intuitive, interactive interface. The dashboard will help users understand patterns in their journaling habits, emotional trends, and provide actionable insights for personal growth.

## Business Context

The AI Insights Dashboard is crucial for demonstrating the value of AI processing to users. It transforms raw AI analysis data into meaningful visualizations that encourage continued engagement and validate the core value proposition of intelligent journaling.

## Requirements

### Functional Requirements

1. **Sentiment Trend Visualization**

   - Interactive line charts showing sentiment over time
   - Weekly, monthly, and yearly views
   - Mood pattern identification and highlighting

2. **Theme Analysis Display**

   - Word cloud visualization of common themes
   - Theme frequency charts and trending topics
   - Tag correlation analysis and suggestions

3. **Emotional Health Metrics**

   - Emotion distribution charts (joy, sadness, anxiety, etc.)
   - Emotional intensity trends over time
   - Wellness score calculation and visualization

4. **Activity Pattern Analysis**

   - Writing frequency heatmaps
   - Peak journaling times and productivity patterns
   - Content length and engagement metrics

5. **Insights Summary**
   - AI-generated summary cards
   - Personalized recommendations
   - Goal progress tracking (if applicable)

### Technical Requirements

1. **Chart Library Integration**

   - Lightweight charting solution (Chart.js or similar)
   - Responsive design for all screen sizes
   - Interactive tooltips and data exploration

2. **Data Processing**

   - Client-side data aggregation for performance
   - Caching of computed visualizations
   - Real-time updates when new data is processed

3. **Performance Optimization**

   - Lazy loading of chart components
   - Data virtualization for large datasets
   - Progressive data loading

4. **Accessibility**
   - Screen reader compatible charts
   - Alternative text descriptions for visualizations
   - Keyboard navigation support

## Implementation

### 1. Insights Dashboard Component

```javascript
// insights-dashboard.js
class InsightsDashboard {
  constructor(container, apiClient) {
    this.container = container;
    this.apiClient = apiClient;
    this.charts = new Map();
    this.currentTimeRange = "30d";
    this.currentMetrics = ["sentiment", "themes", "emotions"];

    this.init();
  }

  async init() {
    this.render();
    this.attachEventListeners();
    await this.loadInsightsData();
    this.initializeCharts();
  }

  render() {
    this.container.innerHTML = `
            <div class="insights-dashboard">
                <!-- Dashboard Header -->
                <div class="dashboard-header">
                    <h2>Your Insights Dashboard</h2>
                    <div class="dashboard-controls">
                        <select id="time-range-selector" class="form-select">
                            <option value="7d">Last 7 days</option>
                            <option value="30d" selected>Last 30 days</option>
                            <option value="90d">Last 3 months</option>
                            <option value="1y">Last year</option>
                            <option value="all">All time</option>
                        </select>
                        <button class="btn btn-secondary" id="export-insights">
                            Export Insights
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="stats-overview">
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-content">
                            <h3 id="total-entries">-</h3>
                            <p>Total Entries</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üòä</div>
                        <div class="stat-content">
                            <h3 id="avg-sentiment">-</h3>
                            <p>Average Mood</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üè∑Ô∏è</div>
                        <div class="stat-content">
                            <h3 id="top-theme">-</h3>
                            <p>Top Theme</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úçÔ∏è</div>
                        <div class="stat-content">
                            <h3 id="avg-words">-</h3>
                            <p>Avg Words/Entry</p>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <!-- Sentiment Trend Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Sentiment Trends</h3>
                            <div class="chart-controls">
                                <button class="btn btn-sm btn-outline-primary" data-chart="sentiment" data-view="daily">
                                    Daily
                                </button>
                                <button class="btn btn-sm btn-primary" data-chart="sentiment" data-view="weekly">
                                    Weekly
                                </button>
                                <button class="btn btn-sm btn-outline-primary" data-chart="sentiment" data-view="monthly">
                                    Monthly
                                </button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="sentiment-chart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-insights">
                            <p id="sentiment-insights" class="text-muted">
                                Loading sentiment insights...
                            </p>
                        </div>
                    </div>

                    <!-- Emotion Distribution -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Emotion Distribution</h3>
                            <div class="chart-info">
                                <span class="info-icon" data-bs-toggle="tooltip"
                                      title="Shows the distribution of emotions detected in your entries">
                                    ‚ÑπÔ∏è
                                </span>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="emotions-chart" width="400" height="200"></canvas>
                        </div>
                        <div class="emotions-legend">
                            <div id="emotions-list" class="emotions-tags">
                                <!-- Dynamic emotion tags -->
                            </div>
                        </div>
                    </div>

                    <!-- Theme Analysis -->
                    <div class="chart-container full-width">
                        <div class="chart-header">
                            <h3>Theme Analysis</h3>
                            <div class="chart-controls">
                                <button class="btn btn-sm btn-primary" data-view="wordcloud">
                                    Word Cloud
                                </button>
                                <button class="btn btn-sm btn-outline-primary" data-view="barchart">
                                    Bar Chart
                                </button>
                                <button class="btn btn-sm btn-outline-primary" data-view="timeline">
                                    Timeline
                                </button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <div id="themes-visualization" class="themes-container">
                                <!-- Dynamic theme visualization -->
                            </div>
                        </div>
                        <div class="themes-insights">
                            <div class="row">
                                <div class="col-md-6">
                                    <h4>Trending Themes</h4>
                                    <ul id="trending-themes" class="theme-list">
                                        <!-- Dynamic trending themes -->
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h4>Emerging Topics</h4>
                                    <ul id="emerging-themes" class="theme-list">
                                        <!-- Dynamic emerging themes -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Writing Patterns -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Writing Patterns</h3>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="patterns-chart" width="400" height="200"></canvas>
                        </div>
                        <div class="patterns-insights">
                            <div class="writing-stats">
                                <div class="stat">
                                    <span class="label">Most Active Day:</span>
                                    <span id="most-active-day">-</span>
                                </div>
                                <div class="stat">
                                    <span class="label">Peak Writing Time:</span>
                                    <span id="peak-time">-</span>
                                </div>
                                <div class="stat">
                                    <span class="label">Writing Streak:</span>
                                    <span id="writing-streak">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Insights -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Personal Insights</h3>
                        </div>
                        <div class="insights-content">
                            <div id="ai-insights" class="ai-insights">
                                <!-- AI-generated insights -->
                            </div>
                            <div class="recommendations">
                                <h4>Recommendations</h4>
                                <ul id="recommendations-list" class="recommendations-list">
                                    <!-- Dynamic recommendations -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loading-overlay" class="loading-overlay d-none">
                    <div class="loading-content">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading insights...</span>
                        </div>
                        <p>Generating your insights...</p>
                    </div>
                </div>

                <!-- Error State -->
                <div id="error-state" class="error-state d-none">
                    <div class="error-content">
                        <h3>Unable to load insights</h3>
                        <p>We're having trouble generating your insights. Please try again.</p>
                        <button class="btn btn-primary" id="retry-insights">
                            Retry
                        </button>
                    </div>
                </div>
            </div>
        `;
  }

  attachEventListeners() {
    // Time range selector
    const timeRangeSelector = this.container.querySelector(
      "#time-range-selector"
    );
    timeRangeSelector.addEventListener("change", (e) => {
      this.currentTimeRange = e.target.value;
      this.updateAllCharts();
    });

    // Chart view controls
    this.container.addEventListener("click", (e) => {
      if (e.target.dataset.chart && e.target.dataset.view) {
        this.updateChartView(e.target.dataset.chart, e.target.dataset.view);
        this.updateActiveButton(e.target);
      }
    });

    // Export functionality
    const exportBtn = this.container.querySelector("#export-insights");
    exportBtn.addEventListener("click", () => this.exportInsights());

    // Retry button
    const retryBtn = this.container.querySelector("#retry-insights");
    retryBtn.addEventListener("click", () => this.loadInsightsData());
  }

  async loadInsightsData() {
    try {
      this.showLoading();

      const [analytics, insights, patterns] = await Promise.all([
        this.apiClient.get(`/analytics?range=${this.currentTimeRange}`),
        this.apiClient.get(`/insights?range=${this.currentTimeRange}`),
        this.apiClient.get(`/patterns?range=${this.currentTimeRange}`),
      ]);

      this.analyticsData = analytics;
      this.insightsData = insights;
      this.patternsData = patterns;

      this.updateQuickStats();
      this.hideLoading();
    } catch (error) {
      console.error("Failed to load insights data:", error);
      this.showError();
    }
  }

  initializeCharts() {
    this.initSentimentChart();
    this.initEmotionsChart();
    this.initThemesVisualization();
    this.initPatternsChart();
    this.updatePersonalInsights();
  }

  initSentimentChart() {
    const ctx = this.container
      .querySelector("#sentiment-chart")
      .getContext("2d");

    const sentimentChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: this.getSentimentLabels(),
        datasets: [
          {
            label: "Sentiment Score",
            data: this.getSentimentData(),
            borderColor: "#4F46E5",
            backgroundColor: "rgba(79, 70, 229, 0.1)",
            borderWidth: 2,
            fill: true,
            tension: 0.4,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false,
          },
          tooltip: {
            callbacks: {
              label: (context) => {
                const value = context.parsed.y;
                const sentiment =
                  value > 0.5
                    ? "Positive"
                    : value < -0.5
                    ? "Negative"
                    : "Neutral";
                return `Sentiment: ${sentiment} (${value.toFixed(2)})`;
              },
            },
          },
        },
        scales: {
          y: {
            beginAtZero: true,
            min: -1,
            max: 1,
            ticks: {
              callback: function (value) {
                return value > 0.5
                  ? "Positive"
                  : value < -0.5
                  ? "Negative"
                  : "Neutral";
              },
            },
          },
        },
      },
    });

    this.charts.set("sentiment", sentimentChart);
  }

  initEmotionsChart() {
    const ctx = this.container
      .querySelector("#emotions-chart")
      .getContext("2d");
    const emotionsData = this.getEmotionsData();

    const emotionsChart = new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: emotionsData.labels,
        datasets: [
          {
            data: emotionsData.values,
            backgroundColor: [
              "#10B981", // joy - green
              "#F59E0B", // excitement - amber
              "#EF4444", // anger - red
              "#6366F1", // sadness - indigo
              "#EC4899", // love - pink
              "#8B5CF6", // fear - purple
              "#06B6D4", // surprise - cyan
              "#84CC16", // contentment - lime
            ],
            borderWidth: 2,
            borderColor: "#ffffff",
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false,
          },
          tooltip: {
            callbacks: {
              label: (context) => {
                const label = context.label;
                const value = context.parsed;
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const percentage = ((value / total) * 100).toFixed(1);
                return `${label}: ${percentage}%`;
              },
            },
          },
        },
      },
    });

    this.charts.set("emotions", emotionsChart);
    this.updateEmotionsLegend(emotionsData);
  }

  initThemesVisualization() {
    const container = this.container.querySelector("#themes-visualization");
    const themesData = this.getThemesData();

    // Start with word cloud view
    this.renderWordCloud(container, themesData);
  }

  renderWordCloud(container, themesData) {
    // Simple word cloud implementation
    container.innerHTML = `
            <div class="word-cloud">
                ${themesData
                  .map(
                    (theme) => `
                    <span class="word-cloud-item"
                          style="font-size: ${this.getWordSize(
                            theme.frequency
                          )}px;
                                 color: ${this.getWordColor(theme.sentiment)}">
                        ${theme.name}
                    </span>
                `
                  )
                  .join("")}
            </div>
        `;
  }

  initPatternsChart() {
    const ctx = this.container
      .querySelector("#patterns-chart")
      .getContext("2d");
    const patternsData = this.getPatternsData();

    const patternsChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
        datasets: [
          {
            label: "Entries per Day",
            data: patternsData.dayOfWeek,
            backgroundColor: "rgba(79, 70, 229, 0.8)",
            borderColor: "#4F46E5",
            borderWidth: 1,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false,
          },
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              stepSize: 1,
            },
          },
        },
      },
    });

    this.charts.set("patterns", patternsChart);
  }

  updateQuickStats() {
    const stats = this.analyticsData.summary;

    this.container.querySelector("#total-entries").textContent =
      stats.totalEntries || 0;
    this.container.querySelector("#avg-sentiment").textContent =
      stats.averageSentiment
        ? this.formatSentiment(stats.averageSentiment)
        : "-";
    this.container.querySelector("#top-theme").textContent =
      stats.topTheme || "-";
    this.container.querySelector("#avg-words").textContent = stats.averageWords
      ? Math.round(stats.averageWords)
      : "-";
  }

  updatePersonalInsights() {
    const insights = this.insightsData.personalInsights || [];
    const recommendations = this.insightsData.recommendations || [];

    const insightsContainer = this.container.querySelector("#ai-insights");
    insightsContainer.innerHTML = insights
      .map(
        (insight) => `
            <div class="insight-card">
                <h5>${insight.title}</h5>
                <p>${insight.description}</p>
                <small class="text-muted">Confidence: ${(
                  insight.confidence * 100
                ).toFixed(0)}%</small>
            </div>
        `
      )
      .join("");

    const recommendationsContainer = this.container.querySelector(
      "#recommendations-list"
    );
    recommendationsContainer.innerHTML = recommendations
      .map(
        (rec) => `
            <li class="recommendation-item">
                <strong>${rec.title}</strong>
                <p>${rec.description}</p>
            </li>
        `
      )
      .join("");
  }

  // Utility methods
  getSentimentLabels() {
    return this.analyticsData?.sentiment?.labels || [];
  }

  getSentimentData() {
    return this.analyticsData?.sentiment?.values || [];
  }

  getEmotionsData() {
    return this.analyticsData?.emotions || { labels: [], values: [] };
  }

  getThemesData() {
    return this.analyticsData?.themes || [];
  }

  getPatternsData() {
    return this.analyticsData?.patterns || { dayOfWeek: [] };
  }

  formatSentiment(score) {
    if (score > 0.3) return "üòä Positive";
    if (score < -0.3) return "üòî Negative";
    return "üòê Neutral";
  }

  getWordSize(frequency) {
    return Math.max(12, Math.min(32, frequency * 20));
  }

  getWordColor(sentiment) {
    if (sentiment > 0.2) return "#10B981";
    if (sentiment < -0.2) return "#EF4444";
    return "#6B7280";
  }

  showLoading() {
    this.container.querySelector("#loading-overlay").classList.remove("d-none");
    this.container.querySelector("#error-state").classList.add("d-none");
  }

  hideLoading() {
    this.container.querySelector("#loading-overlay").classList.add("d-none");
  }

  showError() {
    this.container.querySelector("#loading-overlay").classList.add("d-none");
    this.container.querySelector("#error-state").classList.remove("d-none");
  }

  async exportInsights() {
    try {
      const data = {
        analytics: this.analyticsData,
        insights: this.insightsData,
        patterns: this.patternsData,
        generatedAt: new Date().toISOString(),
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], {
        type: "application/json",
      });

      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `englog-insights-${this.currentTimeRange}.json`;
      a.click();

      URL.revokeObjectURL(url);
    } catch (error) {
      console.error("Failed to export insights:", error);
      alert("Failed to export insights. Please try again.");
    }
  }
}

// Initialize dashboard
export function initInsightsDashboard(container, apiClient) {
  return new InsightsDashboard(container, apiClient);
}
```

### 2. CSS Styling

```css
/* insights-dashboard.css */
.insights-dashboard {
  padding: 2rem;
  max-width: 1400px;
  margin: 0 auto;
}

.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.dashboard-controls {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.stats-overview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.stat-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.5rem;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
}

.stat-icon {
  font-size: 2rem;
  width: 3rem;
  height: 3rem;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(79, 70, 229, 0.1);
  border-radius: 50%;
}

.stat-content h3 {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 600;
  color: #1f2937;
}

.stat-content p {
  margin: 0;
  color: #6b7280;
  font-size: 0.875rem;
}

.charts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 2rem;
}

.chart-container {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
}

.chart-container.full-width {
  grid-column: 1 / -1;
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.chart-header h3 {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
}

.chart-controls {
  display: flex;
  gap: 0.5rem;
}

.chart-wrapper {
  position: relative;
  height: 300px;
  margin-bottom: 1rem;
}

.chart-insights {
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

.word-cloud {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: center;
  align-items: center;
  min-height: 200px;
  padding: 1rem;
}

.word-cloud-item {
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.word-cloud-item:hover {
  transform: scale(1.1);
}

.emotions-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.emotion-tag {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.75rem;
  background: #f3f4f6;
  border-radius: 20px;
  font-size: 0.875rem;
}

.themes-insights {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

.theme-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.theme-list li {
  padding: 0.5rem 0;
  border-bottom: 1px solid #f3f4f6;
  display: flex;
  justify-content: between;
  align-items: center;
}

.writing-stats {
  display: grid;
  grid-template-columns: 1fr;
  gap: 0.75rem;
}

.writing-stats .stat {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0;
}

.writing-stats .label {
  font-weight: 500;
  color: #6b7280;
}

.ai-insights {
  margin-bottom: 1.5rem;
}

.insight-card {
  padding: 1rem;
  background: #f8fafc;
  border-radius: 8px;
  margin-bottom: 1rem;
  border-left: 4px solid #4f46e5;
}

.insight-card h5 {
  margin: 0 0 0.5rem 0;
  color: #1f2937;
}

.insight-card p {
  margin: 0 0 0.5rem 0;
  color: #4b5563;
}

.recommendations-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.recommendation-item {
  padding: 1rem;
  background: #ecfdf5;
  border-radius: 8px;
  margin-bottom: 0.75rem;
  border-left: 4px solid #10b981;
}

.recommendation-item strong {
  color: #065f46;
}

.recommendation-item p {
  margin: 0.25rem 0 0 0;
  color: #047857;
}

.loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.loading-content {
  text-align: center;
}

.error-state {
  text-align: center;
  padding: 3rem;
  color: #6b7280;
}

/* Responsive Design */
@media (max-width: 768px) {
  .insights-dashboard {
    padding: 1rem;
  }

  .charts-grid {
    grid-template-columns: 1fr;
  }

  .chart-container {
    padding: 1rem;
  }

  .dashboard-header {
    flex-direction: column;
    align-items: stretch;
  }

  .dashboard-controls {
    flex-direction: column;
  }

  .stats-overview {
    grid-template-columns: 1fr;
  }

  .chart-header {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .insights-dashboard {
    background: #111827;
    color: #f9fafb;
  }

  .stat-card,
  .chart-container {
    background: #1f2937;
    border-color: #374151;
  }

  .stat-content h3 {
    color: #f9fafb;
  }

  .chart-header h3 {
    color: #f9fafb;
  }

  .insight-card {
    background: #374151;
  }

  .recommendation-item {
    background: #065f46;
  }
}
```

## Testing Strategy

### Unit Tests

```javascript
// tests/insights-dashboard.test.js
import { jest } from "@jest/globals";
import { InsightsDashboard } from "../insights-dashboard.js";

describe("InsightsDashboard", () => {
  let container, mockApiClient, dashboard;

  beforeEach(() => {
    container = document.createElement("div");
    document.body.appendChild(container);

    mockApiClient = {
      get: jest.fn(),
    };

    dashboard = new InsightsDashboard(container, mockApiClient);
  });

  afterEach(() => {
    document.body.removeChild(container);
  });

  describe("initialization", () => {
    test("should render dashboard structure", () => {
      expect(container.querySelector(".insights-dashboard")).toBeTruthy();
      expect(container.querySelector(".dashboard-header")).toBeTruthy();
      expect(container.querySelector(".charts-grid")).toBeTruthy();
    });

    test("should initialize with default time range", () => {
      expect(dashboard.currentTimeRange).toBe("30d");
    });
  });

  describe("data loading", () => {
    test("should load analytics data from API", async () => {
      const mockData = {
        summary: { totalEntries: 10, averageSentiment: 0.5 },
        sentiment: { labels: ["Day 1"], values: [0.5] },
      };

      mockApiClient.get.mockResolvedValue(mockData);

      await dashboard.loadInsightsData();

      expect(mockApiClient.get).toHaveBeenCalledWith("/analytics?range=30d");
      expect(dashboard.analyticsData).toEqual(mockData);
    });

    test("should handle API errors gracefully", async () => {
      mockApiClient.get.mockRejectedValue(new Error("API Error"));

      await dashboard.loadInsightsData();

      expect(container.querySelector("#error-state")).not.toHaveClass("d-none");
    });
  });

  describe("chart updates", () => {
    test("should update charts when time range changes", async () => {
      const spy = jest.spyOn(dashboard, "updateAllCharts");

      const selector = container.querySelector("#time-range-selector");
      selector.value = "7d";
      selector.dispatchEvent(new Event("change"));

      expect(dashboard.currentTimeRange).toBe("7d");
      expect(spy).toHaveBeenCalled();
    });
  });

  describe("export functionality", () => {
    test("should export insights data as JSON", async () => {
      dashboard.analyticsData = { test: "data" };

      // Mock URL.createObjectURL and click
      global.URL.createObjectURL = jest.fn(() => "blob:url");
      global.URL.revokeObjectURL = jest.fn();

      const clickSpy = jest.fn();
      jest.spyOn(document, "createElement").mockReturnValue({
        click: clickSpy,
        href: "",
        download: "",
      });

      await dashboard.exportInsights();

      expect(clickSpy).toHaveBeenCalled();
    });
  });
});
```

### Integration Tests

```javascript
// tests/insights-integration.test.js
describe("Insights Dashboard Integration", () => {
  test("should display insights for user journals", async () => {
    // Test with real API endpoints
    const response = await fetch("/api/analytics?range=30d");
    const data = await response.json();

    expect(data).toHaveProperty("summary");
    expect(data).toHaveProperty("sentiment");
    expect(data).toHaveProperty("emotions");
  });
});
```

## Acceptance Criteria

### Core Functionality

- [ ] Dashboard displays sentiment trends over time with interactive charts
- [ ] Emotion distribution visualization shows accurate percentages
- [ ] Theme analysis includes word cloud and trending topics
- [ ] Writing patterns show daily/weekly activity heatmaps
- [ ] AI-generated insights display with confidence scores

### User Experience

- [ ] Dashboard loads within 3 seconds
- [ ] All charts are interactive and responsive
- [ ] Time range filtering updates all visualizations
- [ ] Export functionality generates downloadable insights
- [ ] Mobile-responsive design works on all screen sizes

### Technical Requirements

- [ ] Charts render without external dependencies beyond Chart.js
- [ ] Data aggregation performs efficiently with 1000+ entries
- [ ] Error states handle API failures gracefully
- [ ] Accessibility features support screen readers
- [ ] Performance metrics stay under 2MB total bundle size

### Integration Requirements

- [ ] Integrates with existing authentication system
- [ ] Uses existing API endpoints for analytics data
- [ ] Maintains consistent design with journal interface
- [ ] Supports real-time updates when new data is processed

## Success Metrics

- 80%+ of users view insights dashboard within first week
- Average session time on dashboard > 3 minutes
- 60%+ of users export insights at least once per month
- Dashboard load time < 3 seconds for 95% of users
- User satisfaction score > 4.2/5 for insights usefulness
