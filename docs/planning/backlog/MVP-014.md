# MVP-014: Authentication UI Components

**Feature:** MVP-WEB
**Priority:** P1 (High)
**Effort:** Medium (3 days)
**Dependencies:** MVP-013 (Frontend SPA Foundation)

---

## üìã Objective

Implement comprehensive authentication user interface components including login/registration forms, OAuth provider integration, OTP verification, and user profile management using vanilla JavaScript and responsive design.

## üéØ Technical Scope

### Authentication Forms

- Login form with email/password and OAuth options
- Registration form with email validation
- OTP verification interface for email-based authentication
- Password reset functionality (future-proofing)
- Form validation with real-time feedback

### OAuth Integration UI

- Provider selection buttons (Google, GitHub, Microsoft)
- OAuth flow handling with popup/redirect patterns
- Error handling for OAuth failures
- Loading states during authentication process

### User Profile Interface

- Profile management form (name, email, preferences)
- Account settings interface
- Session management (active sessions, logout options)
- Privacy settings and data export requests

### Responsive Components

- Mobile-first design with touch-friendly interactions
- Progressive enhancement for different screen sizes
- Accessibility compliance (WCAG 2.1 AA)
- Loading states and error messaging

---

## üéØ Acceptance Criteria

### Login/Registration Flow

- [ ] Email/password login form with validation
- [ ] User registration form with email verification
- [ ] OAuth provider buttons with proper branding
- [ ] OTP verification interface for passwordless auth
- [ ] Form validation with user-friendly error messages
- [ ] Loading states during authentication requests

### OAuth Integration

- [ ] Google OAuth integration working end-to-end
- [ ] GitHub OAuth integration working end-to-end
- [ ] Microsoft OAuth integration working end-to-end
- [ ] OAuth error handling with fallback to email auth
- [ ] Proper OAuth state management and security

### User Experience

- [ ] Responsive design working on mobile and desktop
- [ ] Accessibility features (keyboard navigation, screen readers)
- [ ] Clear error messages for authentication failures
- [ ] Smooth transitions between authentication states
- [ ] Remember me functionality for user convenience

### Security & Privacy

- [ ] No sensitive data stored in localStorage/sessionStorage
- [ ] Proper CSRF protection on forms
- [ ] Content Security Policy compliance
- [ ] XSS protection in all form inputs
- [ ] Secure handling of OAuth tokens

---

## üèóÔ∏è Technical Implementation

### Authentication Component Structure

```javascript
// js/components/auth/AuthManager.js
class AuthManager {
  constructor() {
    this.currentUser = null;
    this.authToken = null;
    this.refreshToken = null;
    this.loginModal = null;
    this.registerModal = null;
    this.otpModal = null;

    this.initializeAuthComponents();
    this.checkAuthStatus();
  }

  initializeAuthComponents() {
    this.createLoginModal();
    this.createRegisterModal();
    this.createOTPModal();
    this.attachEventListeners();
  }

  async checkAuthStatus() {
    const token = localStorage.getItem("auth_token");
    if (token && !this.isTokenExpired(token)) {
      await this.validateAndSetUser(token);
    } else {
      this.showAuthRequired();
    }
  }

  createLoginModal() {
    const modalHTML = `
            <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="loginModalLabel">Sign In to EngLog</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="loginForm" class="auth-form">
                                <div class="mb-3">
                                    <label for="loginEmail" class="form-label">Email Address</label>
                                    <input type="email" class="form-control" id="loginEmail" required
                                           aria-describedby="emailHelp" autocomplete="email">
                                    <div class="invalid-feedback"></div>
                                </div>

                                <div class="d-grid gap-2 mb-3">
                                    <button type="submit" class="btn btn-primary" id="loginSubmit">
                                        <span class="button-text">Continue with Email</span>
                                        <span class="button-spinner d-none">
                                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                            Signing in...
                                        </span>
                                    </button>
                                </div>

                                <div class="divider">
                                    <span>or</span>
                                </div>

                                <div class="oauth-providers">
                                    <button type="button" class="btn btn-outline-dark oauth-btn google-btn">
                                        <svg width="18" height="18" viewBox="0 0 24 24">
                                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                        </svg>
                                        Continue with Google
                                    </button>

                                    <button type="button" class="btn btn-outline-dark oauth-btn github-btn">
                                        <svg width="18" height="18" viewBox="0 0 24 24">
                                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                        </svg>
                                        Continue with GitHub
                                    </button>

                                    <button type="button" class="btn btn-outline-dark oauth-btn microsoft-btn">
                                        <svg width="18" height="18" viewBox="0 0 24 24">
                                            <path fill="#f25022" d="M0 0h11.5v11.5H0z"/>
                                            <path fill="#00a4ef" d="M12.5 0H24v11.5H12.5z"/>
                                            <path fill="#7fba00" d="M0 12.5h11.5V24H0z"/>
                                            <path fill="#ffb900" d="M12.5 12.5H24V24H12.5z"/>
                                        </svg>
                                        Continue with Microsoft
                                    </button>
                                </div>
                            </form>

                            <div class="text-center mt-3">
                                <p class="mb-0">Don't have an account?
                                    <a href="#" class="link-primary" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">Sign up</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

    document.body.insertAdjacentHTML("beforeend", modalHTML);
    this.loginModal = new bootstrap.Modal(
      document.getElementById("loginModal")
    );
  }

  createOTPModal() {
    const modalHTML = `
            <div class="modal fade" id="otpModal" tabindex="-1" role="dialog" aria-labelledby="otpModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="otpModalLabel">Verify Your Email</h5>
                        </div>
                        <div class="modal-body">
                            <div class="text-center mb-4">
                                <p>We've sent a 6-digit code to</p>
                                <strong id="otpEmailDisplay"></strong>
                            </div>

                            <form id="otpForm" class="auth-form">
                                <div class="mb-3">
                                    <label for="otpCode" class="form-label">Verification Code</label>
                                    <input type="text" class="form-control text-center" id="otpCode"
                                           maxlength="6" pattern="[0-9]{6}" required
                                           placeholder="000000" autocomplete="one-time-code"
                                           style="font-size: 1.5rem; letter-spacing: 0.5rem;">
                                    <div class="invalid-feedback"></div>
                                </div>

                                <div class="d-grid gap-2 mb-3">
                                    <button type="submit" class="btn btn-primary" id="otpSubmit">
                                        <span class="button-text">Verify Code</span>
                                        <span class="button-spinner d-none">
                                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                            Verifying...
                                        </span>
                                    </button>
                                </div>

                                <div class="text-center">
                                    <p class="mb-0">Didn't receive the code?</p>
                                    <button type="button" class="btn btn-link p-0" id="resendOTP">
                                        Resend Code
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        `;

    document.body.insertAdjacentHTML("beforeend", modalHTML);
    this.otpModal = new bootstrap.Modal(document.getElementById("otpModal"));
  }

  async handleLogin(email) {
    try {
      this.setLoadingState("loginSubmit", true);

      const response = await fetch("/api/v1/auth/otp/request", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ email }),
      });

      if (response.ok) {
        this.loginModal.hide();
        document.getElementById("otpEmailDisplay").textContent = email;
        this.otpModal.show();
        this.currentEmail = email;
      } else {
        const error = await response.json();
        this.showFormError("loginForm", error.message);
      }
    } catch (error) {
      this.showFormError("loginForm", "Network error. Please try again.");
    } finally {
      this.setLoadingState("loginSubmit", false);
    }
  }

  async handleOTPVerification(code) {
    try {
      this.setLoadingState("otpSubmit", true);

      const response = await fetch("/api/v1/auth/otp/verify", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          email: this.currentEmail,
          otp_code: code,
        }),
      });

      if (response.ok) {
        const data = await response.json();
        await this.setAuthTokens(data.access_token, data.refresh_token);
        this.setUser(data.user);
        this.otpModal.hide();
        this.showAuthSuccess();
      } else {
        const error = await response.json();
        this.showFormError("otpForm", error.message);
      }
    } catch (error) {
      this.showFormError("otpForm", "Verification failed. Please try again.");
    } finally {
      this.setLoadingState("otpSubmit", false);
    }
  }

  async handleOAuthLogin(provider) {
    try {
      // Open OAuth popup
      const popup = window.open(
        `/api/v1/auth/oauth/${provider}`,
        "oauth",
        "width=500,height=600,scrollbars=yes,resizable=yes"
      );

      // Listen for OAuth completion
      return new Promise((resolve, reject) => {
        const checkClosed = setInterval(() => {
          if (popup.closed) {
            clearInterval(checkClosed);
            reject(new Error("OAuth cancelled"));
          }
        }, 1000);

        window.addEventListener(
          "message",
          (event) => {
            if (event.origin !== window.location.origin) return;

            clearInterval(checkClosed);
            popup.close();

            if (event.data.success) {
              this.setAuthTokens(
                event.data.access_token,
                event.data.refresh_token
              );
              this.setUser(event.data.user);
              this.loginModal.hide();
              resolve(event.data);
            } else {
              reject(new Error(event.data.error || "OAuth failed"));
            }
          },
          { once: true }
        );
      });
    } catch (error) {
      this.showFormError("loginForm", error.message);
    }
  }

  setLoadingState(buttonId, loading) {
    const button = document.getElementById(buttonId);
    const textSpan = button.querySelector(".button-text");
    const spinnerSpan = button.querySelector(".button-spinner");

    if (loading) {
      button.disabled = true;
      textSpan.classList.add("d-none");
      spinnerSpan.classList.remove("d-none");
    } else {
      button.disabled = false;
      textSpan.classList.remove("d-none");
      spinnerSpan.classList.add("d-none");
    }
  }

  showFormError(formId, message) {
    const form = document.getElementById(formId);
    let errorDiv = form.querySelector(".alert-danger");

    if (!errorDiv) {
      errorDiv = document.createElement("div");
      errorDiv.className = "alert alert-danger mt-3";
      form.appendChild(errorDiv);
    }

    errorDiv.textContent = message;
    errorDiv.style.display = "block";

    // Auto-hide after 5 seconds
    setTimeout(() => {
      errorDiv.style.display = "none";
    }, 5000);
  }

  attachEventListeners() {
    // Login form submission
    document.getElementById("loginForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      if (this.validateEmail(email)) {
        this.handleLogin(email);
      }
    });

    // OTP form submission
    document.getElementById("otpForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const code = document.getElementById("otpCode").value;
      if (code.length === 6) {
        this.handleOTPVerification(code);
      }
    });

    // OAuth buttons
    document.querySelector(".google-btn").addEventListener("click", () => {
      this.handleOAuthLogin("google");
    });

    document.querySelector(".github-btn").addEventListener("click", () => {
      this.handleOAuthLogin("github");
    });

    document.querySelector(".microsoft-btn").addEventListener("click", () => {
      this.handleOAuthLogin("microsoft");
    });

    // Resend OTP
    document.getElementById("resendOTP").addEventListener("click", () => {
      this.handleLogin(this.currentEmail);
    });
  }

  validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  async setAuthTokens(accessToken, refreshToken) {
    this.authToken = accessToken;
    this.refreshToken = refreshToken;

    // Store tokens securely
    localStorage.setItem("auth_token", accessToken);
    localStorage.setItem("refresh_token", refreshToken);

    // Set up automatic token refresh
    this.scheduleTokenRefresh();
  }

  setUser(user) {
    this.currentUser = user;
    document.dispatchEvent(
      new CustomEvent("userAuthenticated", {
        detail: { user },
      })
    );
  }

  showAuthSuccess() {
    // Show success message and redirect to dashboard
    window.location.hash = "#/dashboard";
  }

  isTokenExpired(token) {
    try {
      const payload = JSON.parse(atob(token.split(".")[1]));
      return Date.now() >= payload.exp * 1000;
    } catch {
      return true;
    }
  }

  logout() {
    this.currentUser = null;
    this.authToken = null;
    this.refreshToken = null;

    localStorage.removeItem("auth_token");
    localStorage.removeItem("refresh_token");

    document.dispatchEvent(new CustomEvent("userLoggedOut"));
    window.location.hash = "#/";
  }
}

// Initialize authentication manager
window.authManager = new AuthManager();
```

### CSS Styling for Authentication Components

```css
/* css/components/auth.css */
.auth-form {
  max-width: 400px;
}

.divider {
  position: relative;
  text-align: center;
  margin: 1.5rem 0;
}

.divider::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 1px;
  background-color: var(--bs-border-color);
}

.divider span {
  background-color: var(--bs-body-bg);
  padding: 0 1rem;
  color: var(--bs-secondary);
  font-size: 0.875rem;
}

.oauth-providers {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.oauth-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  border: 1px solid var(--bs-border-color);
  border-radius: var(--bs-border-radius);
  background-color: var(--bs-body-bg);
  color: var(--bs-body-color);
  text-decoration: none;
  transition: all 0.2s ease-in-out;
}

.oauth-btn:hover {
  background-color: var(--bs-light);
  border-color: var(--bs-primary);
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.oauth-btn:active {
  transform: translateY(0);
}

.oauth-btn svg {
  flex-shrink: 0;
}

.button-spinner {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* OTP specific styles */
#otpCode {
  font-family: "Courier New", monospace;
  text-align: center;
}

#otpEmailDisplay {
  color: var(--bs-primary);
  word-break: break-all;
}

/* Responsive design */
@media (max-width: 576px) {
  .modal-dialog {
    margin: 1rem;
  }

  .oauth-btn {
    font-size: 0.875rem;
    padding: 0.625rem 0.875rem;
  }

  .oauth-btn svg {
    width: 16px;
    height: 16px;
  }
}

/* Loading states */
.btn:disabled {
  cursor: not-allowed;
  opacity: 0.65;
}

/* Form validation styles */
.was-validated .form-control:invalid {
  border-color: var(--bs-danger);
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right calc(0.375em + 0.1875rem) center;
  background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.was-validated .form-control:valid {
  border-color: var(--bs-success);
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='m2.3 6.73.8-.77-.1-.1-1.45-1.45L.48 5.55l1.85 1.85.97-.97z'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right calc(0.375em + 0.1875rem) center;
  background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

/* Accessibility improvements */
.oauth-btn:focus {
  outline: 2px solid var(--bs-primary);
  outline-offset: 2px;
}

/* Dark theme support */
[data-bs-theme="dark"] .oauth-btn {
  background-color: var(--bs-dark);
  border-color: var(--bs-secondary);
  color: var(--bs-light);
}

[data-bs-theme="dark"] .oauth-btn:hover {
  background-color: var(--bs-secondary);
  border-color: var(--bs-primary);
}

[data-bs-theme="dark"] .divider::before {
  background-color: var(--bs-secondary);
}

[data-bs-theme="dark"] .divider span {
  background-color: var(--bs-dark);
  color: var(--bs-light);
}
```

---

## üß™ Testing Strategy

### Unit Tests

```javascript
// tests/components/auth.test.js
describe("AuthManager", () => {
  let authManager;
  let mockFetch;

  beforeEach(() => {
    // Setup DOM elements
    document.body.innerHTML = '<div id="app"></div>';

    // Mock fetch
    mockFetch = jest.fn();
    global.fetch = mockFetch;

    // Mock localStorage
    const localStorageMock = {
      getItem: jest.fn(),
      setItem: jest.fn(),
      removeItem: jest.fn(),
    };
    Object.defineProperty(window, "localStorage", {
      value: localStorageMock,
    });

    authManager = new AuthManager();
  });

  describe("Email validation", () => {
    test("validates correct email format", () => {
      expect(authManager.validateEmail("test@example.com")).toBe(true);
      expect(authManager.validateEmail("user.name@domain.co.uk")).toBe(true);
    });

    test("rejects invalid email format", () => {
      expect(authManager.validateEmail("invalid-email")).toBe(false);
      expect(authManager.validateEmail("@domain.com")).toBe(false);
      expect(authManager.validateEmail("test@")).toBe(false);
    });
  });

  describe("OTP flow", () => {
    test("handles successful OTP request", async () => {
      mockFetch.mockResolvedValueOnce({
        ok: true,
        json: async () => ({ success: true }),
      });

      await authManager.handleLogin("test@example.com");

      expect(mockFetch).toHaveBeenCalledWith("/api/v1/auth/otp/request", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: "test@example.com" }),
      });
    });

    test("handles OTP verification", async () => {
      const mockResponse = {
        access_token: "mock-token",
        refresh_token: "mock-refresh",
        user: { id: "123", email: "test@example.com" },
      };

      mockFetch.mockResolvedValueOnce({
        ok: true,
        json: async () => mockResponse,
      });

      authManager.currentEmail = "test@example.com";
      await authManager.handleOTPVerification("123456");

      expect(localStorage.setItem).toHaveBeenCalledWith(
        "auth_token",
        "mock-token"
      );
      expect(authManager.currentUser).toEqual(mockResponse.user);
    });
  });

  describe("Token management", () => {
    test("detects expired tokens", () => {
      const expiredToken =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MDk0NTkxOTl9.fake";
      expect(authManager.isTokenExpired(expiredToken)).toBe(true);
    });

    test("validates fresh tokens", () => {
      const futureExp = Math.floor(Date.now() / 1000) + 3600; // 1 hour from now
      const freshToken = `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.${btoa(
        JSON.stringify({ exp: futureExp })
      )}.fake`;
      expect(authManager.isTokenExpired(freshToken)).toBe(false);
    });
  });
});
```

### Integration Tests

```javascript
// tests/integration/auth-flow.test.js
describe("Authentication Flow Integration", () => {
  let server;

  beforeAll(async () => {
    server = await setupTestServer();
  });

  afterAll(async () => {
    await server.close();
  });

  test("complete email authentication flow", async () => {
    // Start authentication
    const response1 = await fetch("/api/v1/auth/otp/request", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: "integration@example.com" }),
    });

    expect(response1.status).toBe(200);

    // Simulate OTP verification
    const response2 = await fetch("/api/v1/auth/otp/verify", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        email: "integration@example.com",
        otp_code: "123456", // Test OTP
      }),
    });

    expect(response2.status).toBe(200);
    const authData = await response2.json();
    expect(authData.access_token).toBeDefined();
    expect(authData.user).toBeDefined();
  });
});
```

---

## üìä Configuration & Environment

### Environment Variables

```bash
# OAuth configuration
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret
MICROSOFT_CLIENT_ID=your_microsoft_client_id
MICROSOFT_CLIENT_SECRET=your_microsoft_client_secret

# Email service configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your_email@gmail.com
SMTP_PASSWORD=your_app_password

# JWT configuration
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRY=1h
REFRESH_TOKEN_EXPIRY=7d
```

### Security Configuration

```javascript
// js/utils/security.js
class SecurityUtils {
  static sanitizeInput(input) {
    const div = document.createElement("div");
    div.textContent = input;
    return div.innerHTML;
  }

  static validateCSRFToken() {
    const token = document.querySelector('meta[name="csrf-token"]');
    return token ? token.getAttribute("content") : null;
  }

  static isSecureContext() {
    return window.isSecureContext || window.location.protocol === "https:";
  }

  static generateNonce() {
    const array = new Uint8Array(16);
    crypto.getRandomValues(array);
    return Array.from(array, (b) => b.toString(16).padStart(2, "0")).join("");
  }
}
```

---

## üéØ Definition of Done

### Functional Requirements

- [ ] Login form validates email and triggers OTP flow
- [ ] OAuth providers (Google, GitHub, Microsoft) complete authentication successfully
- [ ] OTP verification form accepts 6-digit codes and authenticates users
- [ ] User profile management allows updating basic information
- [ ] Session management handles token refresh and logout

### Technical Requirements

- [ ] All forms include proper validation and error handling
- [ ] Responsive design works on mobile, tablet, and desktop
- [ ] Accessibility features (ARIA labels, keyboard navigation) implemented
- [ ] Security measures (XSS protection, secure token storage) in place
- [ ] Loading states provide clear feedback during async operations

### Quality Requirements

- [ ] Unit tests cover all authentication logic with 80%+ coverage
- [ ] Integration tests validate complete authentication flows
- [ ] Manual testing confirms UI/UX meets design requirements
- [ ] Security testing validates protection against common attacks
- [ ] Performance testing ensures fast load times and smooth interactions

---

## üìà Success Metrics

- **Authentication Success Rate:** 95%+ successful logins/registrations
- **User Experience:** < 3 clicks to complete authentication
- **Performance:** Authentication forms load in < 2 seconds
- **Security:** Zero XSS or authentication bypass vulnerabilities
- **Accessibility:** WCAG 2.1 AA compliance verified

---

## üîó Dependencies & Integration

- **Depends On:** MVP-013 (Frontend SPA Foundation)
- **Enables:** MVP-015 (Journal Management Interface)
- **API Integration:** MVP-003 (JWT Authentication Service), MVP-004 (OAuth Integration)
- **Testing Integration:** MVP-020 (Integration Testing Suite)

---

**Created:** August 6, 2025
**Assignee:** Frontend Team
**Sprint:** MVP Sprint 3
